This chapter details and validates the procedure for calculating the theoretical average transmission to accurately fit parameters to self-shielded transmission measurements in the URR\cite{Bahran2015}. As shown in \autoref{sec:correction-factor}, the theoretical average transmission can be calculated as the product of the transmission of the average cross section, $e^{-n\langle \sigma \rangle}$, and a transmission correction factor $C_T$. While $C_T$ was previously defined in \autoref{eq:transmission-correction-factor} with an analytical form over an energy range, this procedure is not feasible in the URR where the true cross-section is unknown. Instead, SESH uses Monte Carlo integration in order to determine these energy-averaged quantities\cite{fitacs}.



SESH is used here as the transport engine that computes the self-shielding transmission correction factor $C_T$, while SAMMY performs the parameter fitting. The goal of this chapter is to validate that $C_T$ is calculated correctly and that applying it within SAMMY leads to consistent transmission predictions and stable fits.
\section{Transmission Correction for a Monotopic Sample}
\label{sec:tc-monotopic}

The calculation of the transmission correction factor is centered around a Monte Carlo simulation that generates a statistical population of cross-section realizations. This process, described in detail in Chapters \ref{chap:theory} and \ref{chap:implementation}, simulates the inherent fluctuations of the cross-section in the URR. For each Monte Carlo history, a ``resonance ladder'' is constructed for each channel by sampling resonance widths from the Porter-Thomas\cite{Porter1956} distribution and level spacings from a Wigner distribution\cite{Wigner1951}. These stochastically generated parameters are then used within the SLBW formalism\cite{Lane1958} to produce a single realization of the total microscopic cross-section, $\sigma_i$.

For each sampled cross-section, a corresponding transmission value is calculated, $T_{i} = e^{-n\sigma_{i}}$, where $n$ is the sample thickness. By repeating this for a large number of histories, a set of sampled cross-sections $\left\{ \sigma_{1}, ..., \sigma_{N} \right\}$ and a corresponding set of transmissions $\left\{ T_{1}, ..., T_{N}\right\}$ are obtained. From these sets, their respective averages are computed:
\begin{equation}
    \langle \sigma \rangle = \frac{1}{N} \sum_{i=1}^{N} \sigma_{i}
\end{equation}
and
\begin{equation}
    \langle T \rangle = \frac{1}{N} \sum_{i=1}^{N} T_{i}
\end{equation}

From these averages, the correction factor defined in \autoref{sec:correction-factor} can be approximated as:
\begin{equation}
    C_T \approx \frac{\langle T \rangle}{e^{-n\langle \sigma \rangle}}
\label{eq:CT_mc}
\end{equation}

The accuracy of this method will be validated using $^{181}$Ta, for which a recent evaluation provides new resonance parameters\cite{Brown2024}. The validation is twofold. First, the theoretical model is compared against MCNP simulations to provide a detailed characterization of its performance. As the MCNP model utilizes the exact best-fit parameters from the recent $^{181}$Ta evaluation, it serves as an useful reference case to investigate the effects of physical parameters such as sample thickness and temperature. Second, the calculated average transmission is compared against the experimental data that was used in the evaluation. This comparison serves to validate the theoretical model's overall performance for a single sample thickness, serving as a final integration test for SESHâ€™s theoretical self-shielded transmission calculation.

\section{Verification of the Correction Factor Model}
Before integrating the transmission correction into the fitting procedure, it is essential to verify that SESH accurately calculates the correction factor itself. The verification was performed by comparing the results from SESH to those from a high-fidelity model of the experiment constructed using MCNP \cite{mcnp}. This MCNP model serves as a computational benchmark\cite{Humbert2014}, providing a a high-fidelity reference against which the statistical methods in SESH can be compared. Three key physical parameters that could influence the correction factor were investigated: the number of external resonance pairs used in the calculation, the physical thickness of the sample, and the temperature of the sample.

\subsection{MCNP Reference Model}
\label{ssec:mcnp-benchmark-model}

MCNP is used here as a transport reference: both MCNP and SAMMY/SESH use the same evaluated nuclear data, so the comparison primarily tests the correction method and its implementation rather than differences in input cross sections.
\label{ssec:mcnp-benchmark-model}
The MCNP model was configured to simulate neutron transmission through a $^{181}$Ta sample. The cross-section data for the simulation was prepared from the ENDF/B-VIII.1 evaluation \cite{endf-manual} and processed into a pointwise format using NJOY \cite{njoy}. By using the exact, finely-resolved cross sections from a formal evaluation, the MCNP simulation can directly calculate the true average transmission, $\langle T \rangle$, and the transmission of the average cross section, $e^{-n\langle\sigma\rangle}$, over a given energy group. The benchmark correction factor is then calculated as:
\begin{equation}
    C_{T, \text{MCNP}} = \frac{\langle T \rangle_{\text{P-Table=ON}}}{\langle T \rangle_{\text{P-Table=OFF}}}
\end{equation}
This provides an ideal reference value, free from the statistical approximations inherent to the SESH methodology, against which SESH's calculations can be validated.

\subsection{Monte Carlo Convergence}
\label{ssec:mc-convergence}

The preceding subsections validated the accuracy of the SESH correction factor against an MCNP benchmark, but the Monte Carlo procedure introduces a separate concern: statistical precision. Because $C_T$ is estimated from a finite sample of resonance ladder realizations, each evaluation carries a random fluctuation whose magnitude depends on both the number of histories $N$ and the physical conditions of the calculation. In a standalone comparison to data this fluctuation simply widens the scatter in the theoretical prediction. In the context of iterative fitting, however, an imprecise $C_T$ corrupts the derivative information used by the Bayesian update, causing the fit to oscillate around the minimum rather than converge smoothly.

To characterize the convergence behavior, the correction factor was computed for a 4~mm $^{181}$Ta sample at 300~K using four external resonance pairs at three representative energies spanning the URR: 5~keV, where self-shielding is strongest ($C_T \approx 1.043$); 20~keV, where the correction is moderate ($C_T \approx 1.006$); and 80~keV, where it is negligible ($C_T \approx 1.0005$). At each energy, the number of Monte Carlo histories was varied from $N = 25$ to $N = 100{,}000$, with 30 independent trials performed at each value of $N$ to estimate the standard deviation of the $C_T$ estimator.

\autoref{fig:ct-convergence-means} shows convergence of the computed correction factor as a function of $N$ at each energy. The mean value is stable across all $N$, confirming that the Monte Carlo estimator is unbiased. The error bars contract monotonically with increasing $N$, and the effect is most pronounced at 5~keV where the cross-section fluctuations are largest. At 80~keV, where the level density is high and individual resonances overlap strongly, even $N = 25$ histories produce a correction factor that is effectively converged.

The convergence rate is quantified more precisely in \autoref{fig:ct-convergence-precision}, which plots the relative standard deviation of $C_T$ against $N$. All three energies follow the expected $1/\sqrt{N}$ scaling of a Monte Carlo estimator, confirming that the variance arises from the stochastic sampling of resonance ladders and not from any systematic instability in the algorithm. The vertical separation between the curves reflects the magnitude of the self-shielding correction: larger corrections produce wider cross-section distributions, which require more histories to average precisely.

For the purpose of evaluating resonance parameters, the precision requirement on $C_T$ is more stringent than might be suggested by the correction factor alone. During fitting, SAMMY updates the average resonance parameters iteratively, with each step relying on the partial derivatives of the theoretical transmission with respect to the fitted quantities. When $C_T$ carries excessive statistical noise, these derivatives are contaminated, and the fit oscillates near the minimum rather than converging to it. In practice, this manifests as a final $\chi^2$ that fluctuates between iterations without settling, particularly for the strength functions whose effect on $C_T$ is small but physically meaningful. Empirically, stable convergence of the fitting procedure requires the relative precision on $C_T$ to be well below the sensitivity of the transmission to a single parameter step, which for typical URR evaluations corresponds to a relative standard deviation on the order of 0.1\% or better.

From \autoref{fig:ct-convergence-precision}, this threshold is reached at approximately $N = 50{,}000$ for the most heavily self-shielded case at 5~keV, where the relative standard deviation falls to 0.07\%. At 20~keV the same precision is achieved near $N = 10{,}000$, and at 80~keV it is reached with only a few hundred histories. In general, the required number of histories scales with the magnitude of the self-shielding correction: thicker samples of isotopes with wider resonance-width distributions and lower level densities will require more histories to achieve the same statistical precision. For the evaluations presented in \autoref{chap:evaluation}, $N = 50{,}000$ histories were used at all energies to ensure that the Monte Carlo noise in $C_T$ does not limit the fitting precision.

\begin{figure}[H]
    \centering
    \includegraphics[width=\textwidth]{Transmission Correction/Figures/ct_convergence_means.pdf}
    \caption{Convergence of the transmission correction factor for a 4~mm $^{181}$Ta sample at 300~K at three representative URR energies. Each point is the mean of 30 independent calculations; error bars show $\pm 1\sigma$. The dashed lines indicate the converged value at $N = 100{,}000$. The mean is unbiased at all $N$; only the statistical spread decreases with increasing history count.}
    \label{fig:ct-convergence-means}
\end{figure}

\begin{figure}[H]
    \centering
    \includegraphics[width=0.75\textwidth]{Transmission Correction/Figures/ct_convergence_precision.pdf}
    \caption{Relative standard deviation of the correction factor as a function of the number of Monte Carlo histories. The dashed line shows the expected $1/\sqrt{N}$ scaling. At 5~keV, where self-shielding is strongest, approximately $50{,}000$ histories are needed to reduce the relative uncertainty below 0.1\%. At higher energies where the correction is smaller, fewer histories suffice.}
    \label{fig:ct-convergence-precision}
\end{figure}

\subsection{Influence of External Resonance Pairs}
\label{ssec:resonance-pairs}

The Monte Carlo procedure in SESH constructs a set of resonance ladders within each energy bin by sampling level spacings and widths from their respective statistical distributions. In practice, the cross section at any point within the bin is not determined solely by the resonances inside it --- the tails of nearby resonances outside the bin also contribute. The question is how many of these external resonances need to be included to produce a statistically representative sample of the cross-section fluctuations.

When resonance widths are much larger than the mean level spacing ($\Gamma \gg D$), the cross section at a given energy is the incoherent sum of many overlapping resonance contributions, and the fine details of any individual resonance placement become unimportant\cite{ERICSON1963390}. In this regime, even a modest number of external resonances captures the essential behavior. However, $\Gamma/D$ is not uniformly large across the URR. At lower energies where level densities are smaller and resonances are more isolated, the cross section within a bin can be sensitive to whether a particular external resonance happens to sit just outside the bin edge. Monahan and Elwyn\cite{MONAHAN1967683} showed that fluctuations in the averaged compound cross section depend on both the width and spacing distributions, meaning that truncating the resonance ladder too aggressively can bias the sampled cross-section distribution and, in turn, the correction factor.

The SESH code addresses this by allowing the user to specify a number of external resonance pairs: resonances placed above and below the bin boundaries spaced by sampling from the Wigner Distribution\cite{Wigner1951}. Adding more pairs extends the sampled ladder further from the bin edges, ensuring that the tails of distant resonances are properly included in the cross-section calculation. To quantify the impact of this setting, the correction factor was calculated for a 4~mm $^{181}$Ta sample at 300~K using one through four external resonance pairs.

The results, shown in \autoref{fig:tc-resonance-pairs}, demonstrate that the inclusion of external resonance pairs has a slight but noticeable influence on the calculated correction factor. As more pairs are added, the SESH calculation converges toward the MCNP benchmark value, with the relative error decreasing correspondingly. The effect is most visible at lower energies where the resonances are less overlapping and the bin-edge truncation matters more. By four external pairs the improvement saturates, and additional pairs produce no further change within the statistical precision of the calculation. For the remainder of this work, four external resonance pairs were used in all SESH calculations.

\begin{figure}[H]
    \centering
    \begin{subfigure}[b]{0.48\textwidth}
        \centering
        \includegraphics[width=\textwidth]{Transmission Correction/Figures/ResonancePairInfluenceOnCT.png}
        \caption{Correction factor comparison}
        \label{fig:tc-resonance-pairs-data}
    \end{subfigure}
    \hfill
    \begin{subfigure}[b]{0.48\textwidth}
        \centering
        \includegraphics[width=\textwidth]{Transmission Correction/Figures/ResonancePairError.png}
        \caption{Relative error}
        \label{fig:tc-resonance-pairs-error}
    \end{subfigure}
    \caption{Transmission correction factor for a 4~mm $^{181}$Ta sample at 300~K as a function of the number of external resonance pairs. (a) SESH calculations compared to the MCNP benchmark. (b) Relative error between SESH and MCNP.}
    \label{fig:tc-resonance-pairs}
\end{figure}


\subsection{Sample Thickness Dependence}
\label{ssec:thickness}

Of the parameters investigated in this chapter, the sample thickness exerts the strongest influence on the transmission correction factor. This sensitivity follows directly from the physics of self-shielding: a thicker sample amplifies the nonlinear relationship between the cross-section fluctuations and the transmitted intensity. As presented in \autoref{eq:taylor-series-expansion},  the correction factor depends on the cross-section variance as $C_T \approx 1 + \frac{1}{2}n^2 \mathrm{Var}(\sigma)$, where $n$ is the sample thickness in atoms per barn. For thin samples the quadratic term is small and $C_T$ remains close to unity. But as $n$ increases the correction grows rapidly and the shape of the cross-section distribution become increasingly important.

To characterize this behavior and determine the range of applicability for SESH, the correction factor was computed for 2~mm, 4~mm, 8~mm, and 12~mm samples of $^{181}$Ta at 300~K and compared against the MCNP benchmark. The results, shown in \autoref{fig:tc-thickness}, reveal two distinct regimes. For the thinner samples (2--4~mm), the agreement between SESH and MCNP is excellent, with relative errors below 0.1\%. For the thicker samples (8--12~mm), a systematic discrepancy emerges in which SESH predicts a larger correction factor than MCNP, with the disagreement growing as $C_T$ increases beyond approximately 1.5.

This discrepancy initially appears to suggest a limitation of the SESH methodology at large thicknesses. However, the source of the disagreement is not in SESH's Monte Carlo sampling, but rather in the way the MCNP benchmark handles cross-section fluctuations in the URR. MCNP represents the URR cross-section distribution through probability tables, which are pre-generated discrete approximations to the continuous distribution sampled by SESH. When the probability table mean differs from the pointwise cross section used in transport, the standard mean-enforcement procedure (the LSSF=1 method) rescales the entire distribution multiplicatively, which inadvertently alters the variance of the cross-section distribution. Because the self-shielding effect depends directly on this variance, the rescaled probability tables systematically underpredict the correction factor, and the underprediction grows with sample thickness as the transmission becomes more sensitive to the tails of the distribution. A detailed analysis of this probability table variance conservation issue, including its isolation through controlled numerical experiments, is presented in \autoref{chap:multi-isotope}.

For the purposes of this chapter, the key conclusion is that the observed discrepancy at large thicknesses does not indicate an error in the SESH calculation. Rather, it reflects a known limitation of the MCNP probability table methodology that becomes visible precisely when self-shielding is strong. The SESH results, which sample directly from the resonance parameter distributions without the intermediate probability table discretization, are expected to be the more accurate representation in this regime. As a practical guideline for users of the current MCNP-based benchmarking approach, experimental designs that keep $C_T \leq 1.5$ remain in the regime where the two methods agree and the MCNP benchmark can be used with confidence.

\begin{figure}[H]
    \centering
    \begin{subfigure}[b]{0.48\textwidth}
        \centering
        \includegraphics[width=\textwidth]{Transmission Correction/Figures/ct-verification.png}
        \caption{Correction factor comparison}
        \label{fig:tc-thickness-data}
    \end{subfigure}
    \hfill
    \begin{subfigure}[b]{0.48\textwidth}
        \centering
        \includegraphics[width=\textwidth]{Transmission Correction/Figures/ct-verification-err.png}
        \caption{Relative error}
        \label{fig:tc-thickness-error}
    \end{subfigure}
    \caption{Transmission correction factor for various thicknesses of a $^{181}$Ta sample at 300~K. (a) SESH calculations compared to the MCNP benchmark. (b) Relative error between SESH and MCNP, showing increasing deviation for thicker samples where $C_T$ exceeds 1.5.}
    \label{fig:tc-thickness}
\end{figure}


\subsection{Verification of Sample Temperature Dependence}
The final parameter investigated was the sample temperature, which influences the Doppler broadening of the resonances. The $^{181}$Ta evaluation was processed at five different temperatures: 100~K, 200~K, 300~K, 400~K, and 500~K. These cross sections were used to calculate the correction factor in MCNP for a 4~mm thick sample, which was then compared to the SESH results at the same temperatures.

The results, presented in \autoref{fig:tc-temperature} and \autoref{fig:tc-temperature-error}, show a very strong agreement between SESH and MCNP across all examined temperatures. The relative error does not exhibit any significant bias with temperature, indicating that the Doppler broadening and other temperature-dependent physics are correctly modeled in SESH for the purpose of calculating the transmission correction factor.

 \begin{figure}[H]
     \centering
     \includegraphics[width=0.8\textwidth]{Transmission Correction/Figures/SESH_MCNP_Temperature.png}
     \caption{Comparison between MCNP and SESH correction factors at various temperatures for a 4~mm thick $^{181}$Ta sample.}
     \label{fig:tc-temperature}
 \end{figure}

 \begin{figure}[H]
     \centering
     \includegraphics[width=0.8\textwidth]{Transmission Correction/Figures/ct_temperature_err.png}
     \caption{Relative error between SESH and MCNP at various temperatures for a 4~mm thick $^{181}$Ta sample.}
     \label{fig:tc-temperature-error}
 \end{figure}
 
\section{Integration with the Parameter Fitting Workflow}
After verifying the standalone accuracy of the SESH model, the next crucial step is to integrate it into the SAMMY resonance parameter fitting code. This integration transforms the correction factor from a simple calculation into a dynamic component of the fitting process, allowing experimental transmission data to be fit directly. This requires not only the correction factor itself, but also its derivative with respect to the parameters being adjusted.

\subsection{Numerical Estimation of the Correction Factor Derivative}
The Bayesian fitting algorithm in SAMMY, like many optimization routines, relies on the partial derivative of the theoretical model with respect to each fitting parameter, $u$. For the theoretical transmission, $\langle T \rangle = C_T e^{-n\langle\sigma\rangle}$, the derivative is given by the product rule:
\begin{equation}
    \frac{\partial \langle T \rangle}{\partial u} = e^{-n\langle\sigma\rangle} \frac{\partial C_T}{\partial u} + C_T \frac{\partial e^{-n\langle\sigma\rangle}}{\partial u}
\end{equation}
While the derivative of the Hauser-Feshbach term, $\partial e^{-n\langle\sigma\rangle}/\partial u$, is calculated analytically within SAMMY, the derivative of the correction factor, $\partial C_T / \partial u$, is not straightforward as $C_T$ is the output of a Monte Carlo process.

To solve this, a numerical approach was implemented. For a given parameter $u$ (such as the s-wave strength function, $S_0$), SESH samples the parameter from a narrow distribution around its central value. The resulting distribution of $C_T$ values is then plotted against the sampled parameter values, as shown in \autoref{fig:ct-derivative-regression}. A linear regression is performed on these points, and the slope of the best-fit line is taken as the estimate of the derivative $\partial C_T / \partial u$. This linear regression method was found to be more statistically efficient than a standard finite difference approach, providing a much lower variance in the derivative estimate for the same number of particle histories, as illustrated in \autoref{fig:ct-derivative-variance}.

\begin{figure}[H]
    \centering
    \includegraphics[width=0.75\linewidth]{Transmission Correction/Figures/DerivativeEstimationExample.png}
    \caption{Estimation of $\partial C_T / \partial u$ for $S_0$ at 3~keV using linear regression.}
    \label{fig:ct-derivative-regression}
\end{figure}

\begin{figure}[H]
    \centering
    \includegraphics[width=0.75\linewidth]{Transmission Correction/Figures/DerivativeEstimation.png}
    \caption{Comparison of variance of calculated derivative using linear regression versus finite difference methods at 3~keV for \textsuperscript{181}Ta.}
    \label{fig:ct-derivative-variance}
\end{figure}

\begin{figure}[H]
    \centering
    \includegraphics[width=0.75\linewidth]{Transmission Correction/Figures/DerivativeMethod.png}
    \caption{Variance as a function of total particle histories for both linear regression and finite difference.}
    \label{fig:derivative-variance-reduction}
\end{figure}


\subsection{Verification of the Integrated Fitting Procedure}
With a method to calculate both $C_T$ and its derivative, the fully integrated SESH+SAMMY workflow could be verified. The primary goal of this verification is to demonstrate that the fitting procedure can accurately recover known resonance parameters from synthetic experimental data.

The verification test was structured as follows:
\begin{enumerate}[noitemsep]
    \item Synthetic transmission data for multiple sample thicknesses was generated using MCNP with the known $^{181}$Ta resonance parameters from the ENDF/B-VIII.1 evaluation.
    \item An initial set of incorrect resonance parameters was chosen from an older compilation, the Atlas of Neutron Resonances \cite{atlas}.
    \item The SESH+SAMMY code was used to fit the synthetic MCNP data, starting from the incorrect parameters.
\end{enumerate}

The fitting process was performed twice: once with the numerical derivative calculation for $\partial C_T / \partial u$ enabled, and once assuming $\partial C_T / \partial u = 0$. The latter case represents the implicit assumption made in previous, manual correction workflows. The results, shown in \autoref{fig:fitting-comparison}, demonstrate that both fits converge to similar values. However, as detailed in Table \ref{tab:fitting-error}, enabling the derivative calculation produces a more accurate fit with a lower final $\chi^2/N$. The final converged strength function values in Table \ref{tab:fitting-values} confirm that the new, fully integrated workflow successfully recovers the true parameters used to generate the synthetic data. This verifies that the integration is correct and the derivative estimation is sufficiently accurate for use in the fitting procedure.

\begin{figure}[H]
    \centering
    \includegraphics[width=0.75\linewidth]{Transmission Correction/Figures/DCtFittingPerformance.png}
    \caption{Fitting Result Comparison between numerically estimating the derivative $\partial C_T/\partial u$ versus the assumption $\partial C_T/\partial u=0$ for all parameters.}
    \label{fig:fitting-comparison}
\end{figure}


\begin{table}[H]
    \centering
    \caption{Final reduced chi-square ($\chi^2/N$) at convergence}
    \begin{tabular}{| c | c c |}
        \hline
                               & $\partial C_T / \partial u$=ON  & $\partial C_T / \partial u$=OFF \\ 
                               \hline
        $\chi^2/N$ & 1.981  & 2.444 \\ 
        \hline
    \end{tabular}
    \label{tab:fitting-error}
\end{table}


\begin{table}[H]
    \centering
    \caption{Final Converged Values for both derivative cases}
    \begin{tabular}{|c|ccc|}
        \hline
        Parameter & ENDF-8.1  & $\partial C_T / \partial u =$ON  & $\partial C_T / \partial u =$OFF \\
        \hline
        $S_0 \times 10^{-4}$   & $1.740 \pm 0.03$ & 1.807 & 1.752\\
        $S_1 \times 10^{-4}$   & $0.800 \pm 0.07$ & 0.620 & 0.751\\
        $S_2 \times 10^{-4}$   & $1.690 \pm 0.18$ & 1.486 & 1.499\\
        \hline
    \end{tabular}
    \label{tab:fitting-values}
\end{table}


\section{Summary of Monotopic Transmission Correction Validation}
\label{ssec:tc-monotopic-summary}

The verification exercises detailed in this chapter confirm that the SESH methodology for calculating the transmission correction factor, $C_T$, is accurate for a range of experimental conditions. The model shows strong agreement with high-fidelity MCNP reference models across various sample temperatures and for thicknesses where the correction factor remains below approximately 1.5.

A key investigation was the integration of the correction factor's derivative, $\partial C_T / \partial u$, into the fitting procedure. While the numerical estimation of this derivative via linear regression was shown to be statistically efficient, its impact on the final fitting results was found to be minimal. As shown in Table \ref{tab:fitting-error}, the improvement in the final $\chi^2/N$ when enabling the derivative calculation ($\partial C_T / \partial u = \text{ON}$) versus assuming it to be zero ($\partial C_T / \partial u = \text{OFF}$) is not substantial enough to justify the significant increase in computational time required for its calculation.

Furthermore, historical workflows for self-shielding correction have implicitly operated under the assumption that $\partial C_T / \partial u = 0$. This precedent makes it challenging to validate the derivative-enabled approach against previously published evaluations. Given the minor improvement in fit quality versus the major computational cost and the lack of validation pathways, the most practical and efficient approach for future evaluations is to proceed with the assumption that the derivative of the correction factor is zero. This simplification provides results that are sufficiently accurate and consistent with established methodologies.
